<div class="jumbotron jumbotron-fluid">
    <div class="container">
        <div class="row">
            <div class="col-6">
                <h3 class="display:block;">Upload Image</h3><br/>
                <form class="processUpload" action="/admin/process" method="post" enctype="multipart/form-data">
                    <div class="form-group">
                        <input type="file" name="largeResImg"/>
                        <label for="largeResImg">Choose a large resolution image</label>
                    </div>
                    <div class="form-group">
                        <input type="file" name="rawImg"/>
                        <label for="rawImg">Choose the raw file for the image</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="isAlbum" id="isAlbum"/> 
                        <label class="form-check-label" for="isAlbum">Is image in album ?</label>
                    </div>
                    <div id="album-info-form" style="display: none;">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="isAlbumCover" id="isAlbumCover"/>
                            <label class="form-check-label" for="isAlbumCover">Is image an album cover ?</label>
                        </div>
                        <input class="form-control" type="text" name="albumTitle" placeholder="Album Title"/>
                        <input class="form-control" type="text" name="albumSubTitle" placeholder="Album Subtitle"/>
                    </div>
                    <input class="form-control" type="text" name="caption" placeholder="Caption for image" id="caption"/>
                    <textarea class="form-control" type="text" name="description" placeholder="Description"></textarea>
                    <input type="text" name="tags" id="tags" placeholder="tags"/>
                    <button class="btn btn-primary" type="submit" name="Submit" value="Submit" id="submit">Submit</button>
                </form>
            </div>
            <div class="col-6">
                <h3 class="display:block;">Search Image</h3><br/>
                <form class="search" action="/admin/search" method="get">
                    <input class="form-control" type="text" name="keyword" placeholder="Search for keywords" id="keyword"/>
                    <button class="btn btn-primary" type="submit" name="Search" value="Search" id="search">Search for Images</button>
                </form>
            </div>
        </div>
    </div>
</div>
<div class="container" style="padding: 0 0 0 0;">
    <div class="row">
        <div>
            <select id="results" class="d-none">
                
            </select>
        </div>
    </div>
    <div class="row">
        <div class="controls">
            <button class="btn btn-secondary" type="button" id="download-raw">Download Raw</button>
            <button class="btn btn-secondary" type="button" id="download-small">Download Small</button>
            <button class="btn btn-secondary" type="button" id="download-medium">Download Medium</button>
            <button class="btn btn-secondary" type="button" id="download-large">Download Large</button>
        </div>
    </div>
</div>
<script>
    $(document).ready(function(){
        // init
        $('#tags').selectize({
            delimiter: ',',
            persist: false,
            create: function(input) {
                return {
                    value: input,
                    text: input
                }
            }
        });

        // toggle 
        $(".form-check-input").click(function(){
            console.log("clicked");
            if($('#isAlbumCover').is(":checked")||$('#isAlbum').is(":checked")){
                $("#album-info-form").show();
            }else{
                $("#album-info-form").hide();
            }
        });

        // upload
        $('.processUpload').on('submit', function(e){
            e.preventDefault();
            var _data = new FormData(this);
            $.ajax({
                url: $(this).attr('action'),
                type: $(this).attr('method'),
                encType: $(this).attr('enctype'),
                contentType: false,
                processData: false,
                cache: false,
                data: _data,
                success : function( data ) {
                    console.log(data);
                    //$('#processedImg').prepend($('<img>',{id:'processedImgTag', src: data.img}));
                }
            });
        });

        // search form
        $('.search').on('submit', function(e){
            e.preventDefault();
            var _data = {
                keyword: $('.search #keyword').val()
            };
            $.get({
                url: '/admin/search',
                data: _data,
                cache: false,
                success : function( data ) {
                    $('#results').empty();
                    for(index in data){
                        var result = data[index];
                        /**$('#results').append($('<img>',{id:'processedImgTag', 
                            src: "data:image/png;base64, " + result.data, width:400, height:300}))**/
                         $('#results').append($("<option></option>")
                                                .attr("data-img-src","data:image/png;base64, " + result.data)
                                                .attr("value", result.key)); 
                    }
                    $("#results").imagepicker({
                        hide_select : true,
                        show_label  : false
                    });
                }
            });
        });

        //download controls
        $('#download-small').click(function(){
            console.log($("#results").data('picker'));
            var selectedKey = $("#results option:selected").val();
            window.open('/admin/download?'+ $.param({ key: selectedKey }), '_blank');
        });
    });
</script>