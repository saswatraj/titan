<div class="jumbotron jumbotron-fluid">
    <div class="container">
        <div class="row">
            <div class="col-6" id="create-an-album">
                <h3 class="display:block;">Create Album</h3><br/>
                <form class="processUpload" action="/admin/process" method="post" enctype="multipart/form-data">
                    <div class="form-group">
                        <input type="file" name="largeResImg"/>
                        <label for="largeResImg">Choose a large resolution image</label>
                    </div>
                    <div class="form-group">
                        <input type="file" name="rawImg"/>
                        <label for="rawImg">Choose the raw file for the image</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="isAlbum" id="isAlbum"/> 
                        <label class="form-check-label" for="isAlbum">Is image in album ?</label>
                    </div>
                    <div id="album-info-form">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="isAlbumCover" id="isAlbumCover"/>
                            <label class="form-check-label" for="isAlbumCover">Is image an album cover ?</label>
                        </div>
                        <input class="form-control" type="text" name="albumTitle" id="albumTitle" placeholder="Album Title"/>
                        <input class="form-control" type="text" name="albumSubTitle" id="albumSubTitle" placeholder="Album Subtitle"/>
                    </div>
                    <input class="form-control" type="text" name="caption" placeholder="Caption for image" id="caption"/>
                    <textarea class="form-control" type="text" name="description" id="description" placeholder="Description"></textarea>
                    <input type="text" name="tags" id="tags" placeholder="tags"/>
                    <button class="btn btn-primary" type="submit" name="Submit" value="Submit" id="submit">Submit</button>
                </form>
            </div>
            <div class="col-6" id="upload-to-album" style="display: none;">
                <h3 class="display:block;">Upload to Album</h3><br/>
                <form class="processUpload1" action="/admin/process" method="post" enctype="multipart/form-data">
                    <input type="text" name="id" id="id" class="d-none"/>
                    <div class="form-group">
                        <input type="file" name="largeResImg"/>
                        <label for="largeResImg">Choose a large resolution image</label>
                    </div>
                    <div class="form-group">
                        <input type="file" name="rawImg"/>
                        <label for="rawImg">Choose the raw file for the image</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input d-none" type="checkbox" name="isAlbum" id="isAlbum"/> 
                        <label class="form-check-label d-none" for="isAlbum">Is image in album ?</label>
                    </div>
                    <div id="album-info-form">
                        <div class="form-check">
                            <input class="form-check-input d-none" type="checkbox" name="isAlbumCover" id="isAlbumCover"/>
                            <label class="form-check-label d-none" for="isAlbumCover">Is image an album cover ?</label>
                        </div>
                        <input class="form-control d-none" type="text" name="albumTitle" id="albumTitle" placeholder="Album Title"/>
                        <input class="form-control d-none" type="text" name="albumSubTitle" id="albumSubTitle" placeholder="Album Subtitle"/>
                    </div>
                    <input class="form-control d-none" type="text" name="caption" placeholder="Caption for image" id="caption" />
                    <textarea class="form-control d-none" type="text" name="description" id="description" placeholder="Description"></textarea>
                    <input type="text" name="tags" id="tags1" placeholder="tags" />
                    <button class="btn btn-primary" type="submit" name="Submit" value="Submit" id="submit">Submit</button>
                </form>
            </div>
        </div>
    </div>
</div>
<div class="container" style="padding: 0 0 0 0;">
    <div class="row">
        <h3 class="display:block;">Search Image</h3><br/>
        <form class="search" action="/admin/search" method="get">
            <input class="form-control" type="text" name="keyword" placeholder="Search for keywords" id="keyword"/>
            <button class="btn btn-primary" type="submit" name="Search" value="Search" id="search">Search for Images</button>
        </form>
    </div>
    <div class="row">
        <div>
            <select id="results" class="d-none">
                
            </select>
        </div>
    </div>
    <div class="row">
        <div class="controls">
            <button class="btn btn-secondary" type="button" id="download-raw">Download Raw</button>
            <button class="btn btn-secondary" type="button" id="download-small">Download Small</button>
            <button class="btn btn-secondary" type="button" id="download-medium">Download Medium</button>
            <button class="btn btn-secondary" type="button" id="download-large">Download Large</button>
        </div>
    </div>
</div>
<script>
    $(document).ready(function(){
        // init
        $('#tags').selectize({
            delimiter: ',',
            persist: false,
            create: function(input) {
                return {
                    value: input,
                    text: input
                }
            }
        });

        $('#tags1').selectize({
            delimiter: ',',
            persist: false,
            create: function(input) {
                return {
                    value: input,
                    text: input
                }
            }
        });


        // upload
        $.each(['.processUpload', '.processUpload1'], function(index, value){
            $(value).on('submit', function(e){
                e.preventDefault();
                var _data = new FormData(this);
                $.ajax({
                    url: $(this).attr('action'),
                    type: $(this).attr('method'),
                    encType: $(this).attr('enctype'),
                    contentType: false,
                    processData: false,
                    cache: false,
                    data: _data,
                    success : function( data ) {
                        console.log(data);
                        $('.processUpload1 #albumTitle').val($('.processUpload #albumTitle').val());
                        $('.processUpload1 #albumSubTitle').val($('.processUpload #albumSubTitle').val());
                        $('.processUpload1 #caption').val($('.processUpload #caption').val());
                        $('.processUpload1 #description').val($('.processUpload #description').val());
                        $('.processUpload1 #id').val(data.albumId);
                        $('#create-an-album').hide();
                        $('#upload-to-album').show();
                    }
                });
            });
        });

        // search form
        $('.search').on('submit', function(e){
            e.preventDefault();
            var _data = {
                keyword: $('.search #keyword').val()
            };
            $.get({
                url: '/admin/search',
                data: _data,
                cache: false,
                success : function( data ) {
                    $('#results').empty();
                    for(index in data){
                        var result = data[index];
                        /**$('#results').append($('<img>',{id:'processedImgTag', 
                            src: "data:image/png;base64, " + result.data, width:400, height:300}))**/
                         $('#results').append($("<option></option>")
                                                .attr("data-img-src","data:image/png;base64, " + result.data)
                                                .attr("value", result.key)); 
                    }
                    $("#results").imagepicker({
                        hide_select : true,
                        show_label  : false
                    });
                }
            });
        });

        //download controls
        $('#download-small').click(function(){
            console.log($("#results").data('picker'));
            var selectedKey = $("#results option:selected").val();
            window.open('/admin/download?'+ $.param({ key: selectedKey }), '_blank');
        });
    });
</script>